<script>
document.getElementById("login-form").addEventListener("submit", async function (e) {
  e.preventDefault();

  const usuario = document.getElementById("usuario").value.trim();
  const senha = document.getElementById("senha").value.trim();

  try {
    const urlBackend = "https://seu-backend.onrender.com/login"; // ✅ URL do Render

    const resposta = await fetch(urlBackend, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ usuario, senha })
    });

    if (!resposta.ok) {
      throw new Error('Erro na requisição ao servidor');
    }

    const dados = await resposta.json();

    if (dados.success) { // ✅ ajustado
      const nivel = Number(dados.nivel_permissao); // ✅ ajustado

      localStorage.setItem("usuario", dados.usuario);
      localStorage.setItem("nivel_permissao", nivel);

      window.location.replace("segunda tela.html");
    } else {
      alert(dados.mensagem || "Usuário ou senha incorretos.");
    }
  } catch (erro) {
    alert("Erro ao conectar com o servidor.");
    console.error(erro);
  }
});
</script>
